<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>Claim Capture — Simple Mobile Friendly</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<style>
  :root{--muted:#f6f7f9;--white:#ffffff;--accent:#0b63d6;--danger:#c0392b;--text:#111}
  html,body{height:100%;margin:0;padding:0;background:#fff;color:var(--text);font-family:Inter,Arial,sans-serif}
  .wrap{max-width:780px;margin:14px auto;padding:14px}
  h2{margin:0 0 8px;font-size:18px}
  .hint{font-size:13px;color:#555;margin-bottom:10px}
  .slot{margin-top:12px;padding:12px;border-radius:12px;background:var(--muted);box-shadow:inset 0 0 0 1px rgba(0,0,0,0.03)}
  .slot h3{margin:0 0 6px;font-size:15px}
  .slot .hint{margin:0 0 8px}
  .row{display:flex;gap:10px;align-items:center}
  .thumb{width:110px;height:76px;object-fit:cover;border-radius:8px;border:1px solid #ddd;display:none}
  .btn-white{background:var(--white);border:1px solid #ddd;padding:10px 12px;border-radius:10px;font-weight:700;cursor:pointer}
  .small{font-size:13px;color:#444}
  input[type="file"]{display:none}
  input[type="email"], input[type="text"]{width:100%;padding:10px;border-radius:10px;border:1px solid #e6e6e6;margin-top:8px;font-size:15px}
  .center{text-align:center;margin-top:12px}
  .status{margin-top:12px;font-size:14px}
  .note{font-size:13px;color:#666;margin-top:6px}
</style>
</head>
<body>
  <div class="wrap">
    <h2>Claim Capture — VIN required</h2>
    <p class="hint">Please provide clear photos: Front plate, Back plate, and a close-up of the Chassis/VIN plate (REQUIRED). Optionally add a 360° walk-around video. Use the single white button per slot — it opens the camera on mobile or the file picker on desktop.</p>

    <!-- FRONT -->
    <div class="slot">
      <h3>1) Front plate</h3>
      <p class="hint">Upload or capture (camera will open on mobile).</p>
      <div class="row">
        <label class="btn-white" for="fileFront">Upload / Capture Front</label>
        <input id="fileFront" type="file" accept="image/*" capture="environment">
        <img id="thumb-front" class="thumb" alt="Front thumbnail">
      </div>
    </div>

    <!-- BACK -->
    <div class="slot">
      <h3>2) Back plate</h3>
      <p class="hint">Upload or capture.</p>
      <div class="row">
        <label class="btn-white" for="fileBack">Upload / Capture Back</label>
        <input id="fileBack" type="file" accept="image/*" capture="environment">
        <img id="thumb-back" class="thumb" alt="Back thumbnail">
      </div>
    </div>

    <!-- CHASSIS -->
    <div class="slot">
      <h3>3) Chassis / VIN (REQUIRED)</h3>
      <p class="hint">REQUIRED: upload or capture a clear close-up so the VIN (≈17 chars) is visible.</p>
      <div class="row">
        <label class="btn-white" for="fileChassis">Upload / Capture Chassis (VIN)</label>
        <input id="fileChassis" type="file" accept="image/*" capture="environment">
        <img id="thumb-chassis" class="thumb" alt="Chassis thumbnail">
      </div>
    </div>

    <!-- VIDEO -->
    <div class="slot">
      <h3>Optional: 360° Walk-around Video</h3>
      <p class="hint">Record a short 5–20s walk-around video on your phone (or upload a file).</p>
      <div class="row">
        <label class="btn-white" for="videoFile">Upload / Capture Video</label>
        <input id="videoFile" type="file" accept="video/*" capture="environment">
        <div id="videoPreview" style="margin-left:10px"></div>
      </div>
      <div class="note">Tip: slowly rotate around the vehicle so damage and plates are visible.</div>
    </div>

    <!-- Contact -->
    <div style="margin-top:12px">
      <label class="small">Email (we will notify you)</label>
      <input id="email" type="email" placeholder="you@company.com" />
      <label class="small" style="margin-top:8px">Policy Number (optional)</label>
      <input id="policy" type="text" placeholder="POL- or claim number" />
    </div>

    <div class="center">
      <button class="btn-white" style="margin-top:12px" id="uploadBtn">Upload & Submit</button>
    </div>

    <div id="status" class="status"></div>
  </div>

<script>
/* ====== CONFIG: set your n8n webhook URL here ====== */
const WEBHOOK = "https://pmitsdubai.app.n8n.cloud/webhook-test/capture-upload";
/* ================================================== */

/* Elements */
const fileFront = document.getElementById('fileFront');
const fileBack = document.getElementById('fileBack');
const fileChassis = document.getElementById('fileChassis');
const videoFile = document.getElementById('videoFile');

const thumbFront = document.getElementById('thumb-front');
const thumbBack = document.getElementById('thumb-back');
const thumbChassis = document.getElementById('thumb-chassis');
const videoPreview = document.getElementById('videoPreview');

const uploadBtn = document.getElementById('uploadBtn');
const statusEl = document.getElementById('status');

/* Show thumbnail for images */
function handleImageInput(fileInput, thumbEl){
  const f = fileInput.files && fileInput.files[0];
  if(!f) return;
  if(!f.type.startsWith('image/')) {
    alert('Please select an image file.');
    return;
  }
  thumbEl.src = URL.createObjectURL(f);
  thumbEl.style.display = 'inline-block';
  thumbEl.blob = f; // store blob for upload
}

/* Show preview for video */
function handleVideoInput(file) {
  if(!file) return;
  if(!file.type.startsWith('video/')) { alert('Please select a video file.'); return; }
  videoPreview.innerHTML = '';
  const vid = document.createElement('video');
  vid.controls = true;
  vid.style.maxWidth = '160px';
  vid.src = URL.createObjectURL(file);
  videoPreview.appendChild(vid);
  videoPreview.blob = file;
}

/* wire inputs */
fileFront.addEventListener('change', ()=> handleImageInput(fileFront, thumbFront));
fileBack.addEventListener('change', ()=> handleImageInput(fileBack, thumbBack));
fileChassis.addEventListener('change', ()=> handleImageInput(fileChassis, thumbChassis));
videoFile.addEventListener('change', ()=> handleVideoInput(videoFile.files[0]));

/* upload */
uploadBtn.addEventListener('click', async () => {
  statusEl.innerHTML = '';
  const email = (document.getElementById('email').value || '').trim();
  if(!email){ statusEl.innerHTML = '<span style="color:'+getComputedStyle(document.body).getPropertyValue('--danger')+'">Email is required</span>'; return; }

  // chassis required
  if(!thumbChassis.blob && !(fileChassis.files && fileChassis.files[0])) {
    statusEl.innerHTML = '<span style="color:#c0392b">Chassis/VIN photo is required. Please capture or upload it.</span>';
    return;
  }

  const fd = new FormData();
  fd.append('email', email);
  fd.append('policyNumber', (document.getElementById('policy').value || '').trim());

  // append images (prefer user-captured blob stored on thumb.*.blob if exists, else file inputs)
  if(thumbFront.blob) fd.append('front', thumbFront.blob, 'front.jpg');
  else if(fileFront.files && fileFront.files[0]) fd.append('front', fileFront.files[0]);

  if(thumbBack.blob) fd.append('back', thumbBack.blob, 'back.jpg');
  else if(fileBack.files && fileBack.files[0]) fd.append('back', fileBack.files[0]);

  if(thumbChassis.blob) fd.append('chassis', thumbChassis.blob, 'chassis.jpg');
  else if(fileChassis.files && fileChassis.files[0]) fd.append('chassis', fileChassis.files[0]);

  // video: prefer preview.blob (uploaded) else file input
  if(videoPreview.blob) fd.append('video', videoPreview.blob, 'walkaround.mp4');
  else if(videoFile.files && videoFile.files[0]) fd.append('video', videoFile.files[0]);

  statusEl.innerHTML = 'Uploading — please wait...';
  try{
    const res = await fetch(WEBHOOK, { method: 'POST', body: fd });
    if(res.ok){
      let message = '<span style="color:green">Upload successful. You will receive an email soon.</span>';
      try {
        const j = await res.json();
        message += '<div class="small">Server: ' + JSON.stringify(j) + '</div>';
      } catch(e){}
      statusEl.innerHTML = message;
    } else {
      statusEl.innerHTML = '<span style="color:#c0392b">Upload failed: ' + res.status + ' ' + res.statusText + '</span>';
    }
  }catch(err){
    console.error(err);
    statusEl.innerHTML = '<span style="color:#c0392b">Network error: '+err.message+'</span>';
  }
});
</script>
</body>
</html>
