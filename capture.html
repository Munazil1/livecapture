<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<title>Claim Capture — Simple Mobile Friendly</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<style>
  :root{
    --muted:#f8f9fb;
    --white:#ffffff;
    --accent:#0b63d6;
    --accent-dark:#084a9e;
    --danger:#d63031;
    --success:#27ae60;
    --text:#111;
    --border:#e3e6ea;
  }
  html,body{height:100%;margin:0;padding:0;background:#f4f6f9;color:var(--text);font-family:"Inter",Arial,sans-serif}
  .wrap{max-width:760px;margin:0 auto;padding:20px}
  h2{margin:0 0 12px;font-size:22px;font-weight:600;color:var(--accent)}
  .hint{font-size:14px;color:#555;margin-bottom:14px;line-height:1.4}
  .slot{margin-top:18px;padding:16px;border-radius:14px;background:var(--white);box-shadow:0 1px 3px rgba(0,0,0,0.08),0 4px 12px rgba(0,0,0,0.04)}
  .slot h3{margin:0 0 8px;font-size:16px;font-weight:600;color:#222}
  .slot .hint{margin:0 0 10px;font-size:13px;color:#666}
  .row{display:flex;gap:12px;align-items:center}
  .thumb{width:120px;height:80px;object-fit:cover;border-radius:10px;border:1px solid var(--border);display:none}
  .btn{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:8px;font-weight:600;cursor:pointer;font-size:14px}
  .btn:hover{background:var(--accent-dark)}
  .btn-white{background:var(--white);border:1px solid var(--border);padding:10px 14px;border-radius:8px;font-weight:600;cursor:pointer;font-size:14px}
  .btn-white:hover{background:#f1f3f6}
  .small{font-size:13px;color:#444}
  input[type="file"]{display:none}
  input[type="email"], input[type="text"]{width:100%;padding:11px;border-radius:8px;border:1px solid var(--border);margin-top:6px;font-size:15px}
  .center{text-align:center;margin-top:20px}
  .status{margin-top:16px;font-size:14px;padding:10px 14px;border-radius:8px;display:none}
  .status.success{background:#eafaf1;color:var(--success);display:block}
  .status.error{background:#fdecea;color:var(--danger);display:block}
  .note{font-size:13px;color:#666;margin-top:6px}
</style>
</head>
<body>
  <div class="wrap">
    <h2>Claim Capture</h2>
    <p class="hint">Please upload clear photos of your vehicle: Front plate <b>(required)</b>, Back plate <b>(required)</b>, Chassis/VIN plate <b>(required)</b>, and optional damage photos or 360° walk-around video.</p>

    <!-- FRONT -->
    <div class="slot">
      <h3>1) Front plate (REQUIRED)</h3>
      <div class="row">
        <label class="btn-white" for="fileFront">Upload / Capture Front</label>
        <input id="fileFront" type="file" accept="image/*" capture="environment">
        <img id="thumb-front" class="thumb" alt="Front thumbnail">
      </div>
    </div>

    <!-- BACK -->
    <div class="slot">
      <h3>2) Back plate (REQUIRED)</h3>
      <div class="row">
        <label class="btn-white" for="fileBack">Upload / Capture Back</label>
        <input id="fileBack" type="file" accept="image/*" capture="environment">
        <img id="thumb-back" class="thumb" alt="Back thumbnail">
      </div>
    </div>

    <!-- CHASSIS -->
    <div class="slot">
      <h3>3) Chassis / VIN (REQUIRED)</h3>
      <div class="row">
        <label class="btn-white" for="fileChassis">Upload / Capture Chassis (VIN)</label>
        <input id="fileChassis" type="file" accept="image/*" capture="environment">
        <img id="thumb-chassis" class="thumb" alt="Chassis thumbnail">
      </div>
    </div>

    <!-- DAMAGE PHOTO -->
    <div class="slot">
      <h3>4) Damage Photo</h3>
      <div class="row">
        <label class="btn-white" for="fileDamage">Upload / Capture Damage</label>
        <input id="fileDamage" type="file" accept="image/*" capture="environment">
        <img id="thumb-damage" class="thumb" alt="Damage thumbnail">
      </div>
    </div>

    <!-- VIDEO -->
    <div class="slot">
      <h3>Optional: 360° Walk-around Video</h3>
      <div class="row">
        <label class="btn-white" for="videoFile">Upload / Capture Video</label>
        <input id="videoFile" type="file" accept="video/*" capture="environment">
        <div id="videoPreview" style="margin-left:10px"></div>
      </div>
      <div class="note">Tip: slowly rotate around the vehicle so damage and plates are visible.</div>
    </div>

    <!-- Contact -->
    <div class="slot">
      <h3>Contact Information</h3>
      <label class="small">Email (required, we will notify you)</label>
      <input id="email" type="email" placeholder="you@company.com" />
      <label class="small" style="margin-top:8px">Policy Number (optional)</label>
      <input id="policy" type="text" placeholder="POL- or claim number" />
    </div>

    <div class="center">
      <button class="btn" id="uploadBtn">Upload & Submit</button>
    </div>

    <div id="status" class="status"></div>
  </div>

<script>
/* ====== CONFIG: set your n8n webhook URL here ====== */
const WEBHOOK = "https://pmitsdubai.app.n8n.cloud/webhook-test/capture-upload";
/* ================================================== */

/* Elements */
const fileFront = document.getElementById('fileFront');
const fileBack = document.getElementById('fileBack');
const fileChassis = document.getElementById('fileChassis');
const fileDamage = document.getElementById('fileDamage');
const videoFile = document.getElementById('videoFile');

const thumbFront = document.getElementById('thumb-front');
const thumbBack = document.getElementById('thumb-back');
const thumbChassis = document.getElementById('thumb-chassis');
const thumbDamage = document.getElementById('thumb-damage');
const videoPreview = document.getElementById('videoPreview');

const uploadBtn = document.getElementById('uploadBtn');
const statusEl = document.getElementById('status');

/* Show thumbnail for images */
function handleImageInput(fileInput, thumbEl){
  const f = fileInput.files && fileInput.files[0];
  if(!f) return;
  if(!f.type.startsWith('image/')) {
    alert('Please select an image file.');
    return;
  }
  thumbEl.src = URL.createObjectURL(f);
  thumbEl.style.display = 'inline-block';
  thumbEl.blob = f; // store blob for upload
}

/* Show preview for video */
function handleVideoInput(file) {
  if(!file) return;
  if(!file.type.startsWith('video/')) { alert('Please select a video file.'); return; }
  videoPreview.innerHTML = '';
  const vid = document.createElement('video');
  vid.controls = true;
  vid.style.maxWidth = '160px';
  vid.src = URL.createObjectURL(file);
  videoPreview.appendChild(vid);
  videoPreview.blob = file;
}

/* wire inputs */
fileFront.addEventListener('change', ()=> handleImageInput(fileFront, thumbFront));
fileBack.addEventListener('change', ()=> handleImageInput(fileBack, thumbBack));
fileChassis.addEventListener('change', ()=> handleImageInput(fileChassis, thumbChassis));
fileDamage.addEventListener('change', ()=> handleImageInput(fileDamage, thumbDamage));
videoFile.addEventListener('change', ()=> handleVideoInput(videoFile.files[0]));

/* upload */
uploadBtn.addEventListener('click', async () => {
  statusEl.className = "status";
  statusEl.innerHTML = "";

  const email = (document.getElementById('email').value || '').trim();
  if(!email){ 
    statusEl.className = "status error";
    statusEl.innerHTML = "Email is required.";
    return; 
  }

  // required: front, back, chassis
  if(!thumbFront.blob && !(fileFront.files && fileFront.files[0])) {
    statusEl.className = "status error";
    statusEl.innerHTML = "Front plate photo is required.";
    return;
  }
  if(!thumbBack.blob && !(fileBack.files && fileBack.files[0])) {
    statusEl.className = "status error";
    statusEl.innerHTML = "Back plate photo is required.";
    return;
  }
  if(!thumbChassis.blob && !(fileChassis.files && fileChassis.files[0])) {
    statusEl.className = "status error";
    statusEl.innerHTML = "Chassis/VIN photo is required.";
    return;
  }

  const fd = new FormData();
  fd.append('email', email);
  fd.append('policyNumber', (document.getElementById('policy').value || '').trim());

  // append images
  if(thumbFront.blob) fd.append('front', thumbFront.blob, 'front.jpg');
  else if(fileFront.files && fileFront.files[0]) fd.append('front', fileFront.files[0]);

  if(thumbBack.blob) fd.append('back', thumbBack.blob, 'back.jpg');
  else if(fileBack.files && fileBack.files[0]) fd.append('back', fileBack.files[0]);

  if(thumbChassis.blob) fd.append('chassis', thumbChassis.blob, 'chassis.jpg');
  else if(fileChassis.files && fileChassis.files[0]) fd.append('chassis', fileChassis.files[0]);

  if(thumbDamage.blob) fd.append('damage', thumbDamage.blob, 'damage.jpg');
  else if(fileDamage.files && fileDamage.files[0]) fd.append('damage', fileDamage.files[0]);

  // video
  if(videoPreview.blob) fd.append('video', videoPreview.blob, 'walkaround.mp4');
  else if(videoFile.files && videoFile.files[0]) fd.append('video', videoFile.files[0]);

  statusEl.className = "status";
  statusEl.innerHTML = "Uploading — please wait...";
  statusEl.style.display = "block";

  try{
    const res = await fetch(WEBHOOK, { method: 'POST', body: fd });
    if(res.ok){
      statusEl.className = "status success";
      let message = "Upload successful. You will receive an email soon.";
      try {
        const j = await res.json();
        message += "<div class='small'>Server: " + JSON.stringify(j) + "</div>";
      } catch(e){}
      statusEl.innerHTML = message;
    } else {
      statusEl.className = "status error";
      statusEl.innerHTML = "Upload failed: " + res.status + " " + res.statusText;
    }
  }catch(err){
    console.error(err);
    statusEl.className = "status error";
    statusEl.innerHTML = "Network error: " + err.message;
  }
});
</script>
</body>
</html>
